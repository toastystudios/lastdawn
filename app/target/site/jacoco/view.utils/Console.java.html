<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Console.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Last Dawn</a> &gt; <a href="index.source.html" class="el_package">view.utils</a> &gt; <span class="el_source">Console.java</span></div><h1>Console.java</h1><pre class="source lang-java linenums">/* Last Dawn (c) by Toasty Studios is licensed under
 * Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. (CC BY-NC-ND 4.0)
 * For more information, visit the link: http://creativecommons.org/licenses/by-nc-nd/4.0/
 */
package view.utils;

import java.io.*;
import java.awt.*;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.text.*;

/*
 *  Create a simple console to display text messages.
 *
 *  Messages can be directed here from different sources. Each source can
 *  have its messages displayed in a different color.
 *
 *  Messages can either be appended to the console or inserted as the first
 *  line of the console
 *
 *  You can limit the number of lines to hold in the Document.
 */
public class Console {

    private JTextPane textComponent;
    private Document document;
    private boolean isAppend;
    private DocumentListener limitLinesListener;

    public Console(JTextPane textComponent) {
<span class="nc" id="L32">        this(textComponent, true);</span>
<span class="nc" id="L33">    }</span>

    /*
	 *	Use the text component specified as a simply console to display
	 *  text messages.
	 *
	 *  The messages can either be appended to the end of the console or
	 *  inserted as the first line of the console.
     */
<span class="nc" id="L42">    public Console(JTextPane textComponent, boolean isAppend) {</span>
<span class="nc" id="L43">        this.textComponent = textComponent;</span>
<span class="nc" id="L44">        this.document = textComponent.getDocument();</span>
<span class="nc" id="L45">        this.isAppend = isAppend;</span>
<span class="nc" id="L46">        textComponent.setEditable(false);</span>
<span class="nc" id="L47">    }</span>

    /*
	 *  Redirect the output from the standard output to the console
	 *  using the default text color and null PrintStream
     */
    public void redirectOut() {
<span class="nc" id="L54">        redirectOut(null, null);</span>
<span class="nc" id="L55">    }</span>

    /*
	 *  Redirect the output from the standard output to the console
	 *  using the specified color and PrintStream. When a PrintStream
	 *  is specified the message will be added to the Document before
	 *  it is also written to the PrintStream.
     */
    public void redirectOut(Color textColor, PrintStream printStream) {
<span class="nc" id="L64">        ConsoleOutputStream cos = new ConsoleOutputStream(textColor, printStream);</span>
<span class="nc" id="L65">        System.setOut(new PrintStream(cos, true));</span>
<span class="nc" id="L66">    }</span>

    /*
	 *  Redirect the output from the standard error to the console
	 *  using the default text color and null PrintStream
     */
    public void redirectErr() {
<span class="nc" id="L73">        redirectErr(null, null);</span>
<span class="nc" id="L74">    }</span>

    /*
	 *  Redirect the output from the standard error to the console
	 *  using the specified color and PrintStream. When a PrintStream
	 *  is specified the message will be added to the Document before
	 *  it is also written to the PrintStream.
     */
    public void redirectErr(Color textColor, PrintStream printStream) {
<span class="nc" id="L83">        ConsoleOutputStream cos = new ConsoleOutputStream(textColor, printStream);</span>
<span class="nc" id="L84">        System.setErr(new PrintStream(cos, true));</span>
<span class="nc" id="L85">    }</span>

    /*
	 *  To prevent memory from being used up you can control the number of
	 *  lines to display in the console
	 *
	 *  This number can be dynamically changed, but the console will only
	 *  be updated the next time the Document is updated.
     */
    public void setMessageLines(int lines) {
<span class="nc bnc" id="L95" title="All 2 branches missed.">        if (limitLinesListener != null) {</span>
<span class="nc" id="L96">            document.removeDocumentListener(limitLinesListener);</span>
        }

<span class="nc" id="L99">        limitLinesListener = new LimitLinesDocumentListener(lines, isAppend);</span>
<span class="nc" id="L100">        document.addDocumentListener(limitLinesListener);</span>
<span class="nc" id="L101">    }</span>

    /*
	 *	Class to intercept output from a PrintStream and add it to a Document.
	 *  The output can optionally be redirected to a different PrintStream.
	 *  The text displayed in the Document can be color coded to indicate
	 *  the output source.
     */
    class ConsoleOutputStream extends ByteArrayOutputStream {

<span class="nc" id="L111">        private final String EOL = System.getProperty(&quot;line.separator&quot;);</span>
        private SimpleAttributeSet attributes;
        private PrintStream printStream;
<span class="nc" id="L114">        private StringBuffer buffer = new StringBuffer(80);</span>
        private boolean isFirstLine;

        /*
		 *  Specify the option text color and PrintStream
         */
<span class="nc" id="L120">        public ConsoleOutputStream(Color textColor, PrintStream printStream) {</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">            if (textColor != null) {</span>
<span class="nc" id="L122">                attributes = new SimpleAttributeSet();</span>
<span class="nc" id="L123">                StyleConstants.setForeground(attributes, textColor);</span>
            }

<span class="nc" id="L126">            this.printStream = printStream;</span>

<span class="nc bnc" id="L128" title="All 2 branches missed.">            if (isAppend) {</span>
<span class="nc" id="L129">                isFirstLine = true;</span>
            }
<span class="nc" id="L131">        }</span>

        /*
		 *  Override this method to intercept the output text. Each line of text
		 *  output will actually involve invoking this method twice:
		 *
		 *  a) for the actual text message
		 *  b) for the newLine string
		 *
		 *  The message will be treated differently depending on whether the line
		 *  will be appended or inserted into the Document
         */
        public void flush() {
<span class="nc" id="L144">            String message = toString();</span>

<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (message.length() == 0) {</span>
<span class="nc" id="L147">                return;</span>
            }

<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (isAppend) {</span>
<span class="nc" id="L151">                handleAppend(message);</span>
            } else {
<span class="nc" id="L153">                handleInsert(message);</span>
            }

<span class="nc" id="L156">            reset();</span>
<span class="nc" id="L157">        }</span>

        /*
		 *	We don't want to have blank lines in the Document. The first line
		 *  added will simply be the message. For additional lines it will be:
		 *
		 *  newLine + message
         */
        private void handleAppend(String message) {
            //  This check is needed in case the text in the Document has been
            //	cleared. The buffer may contain the EOL string from the previous
            //  message.

<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (document.getLength() == 0) {</span>
<span class="nc" id="L171">                buffer.setLength(0);</span>
            }

<span class="nc bnc" id="L174" title="All 2 branches missed.">            if (EOL.equals(message)) {</span>
<span class="nc" id="L175">                buffer.append(message);</span>
            } else {
<span class="nc" id="L177">                buffer.append(message);</span>
<span class="nc" id="L178">                clearBuffer();</span>
            }

<span class="nc" id="L181">        }</span>

        /*
		 *  We don't want to merge the new message with the existing message
		 *  so the line will be inserted as:
		 *
		 *  message + newLine
         */
        private void handleInsert(String message) {
<span class="nc" id="L190">            buffer.append(message);</span>

<span class="nc bnc" id="L192" title="All 2 branches missed.">            if (EOL.equals(message)) {</span>
<span class="nc" id="L193">                clearBuffer();</span>
            }
<span class="nc" id="L195">        }</span>

        /*
		 *  The message and the newLine have been added to the buffer in the
		 *  appropriate order so we can now update the Document and send the
		 *  text to the optional PrintStream.
         */
        private void clearBuffer() {
            //  In case both the standard out and standard err are being redirected
            //  we need to insert a newline character for the first line only

<span class="nc bnc" id="L206" title="All 4 branches missed.">            if (isFirstLine &amp;&amp; document.getLength() != 0) {</span>
<span class="nc" id="L207">                buffer.insert(0, &quot;\n&quot;);</span>
            }

<span class="nc" id="L210">            isFirstLine = false;</span>
<span class="nc" id="L211">            String line = buffer.toString();</span>

            try {
<span class="nc bnc" id="L214" title="All 2 branches missed.">                if (isAppend) {</span>
<span class="nc" id="L215">                    int offset = document.getLength();</span>
<span class="nc" id="L216">                    document.insertString(offset, line, attributes);</span>
<span class="nc" id="L217">                    textComponent.setCaretPosition(document.getLength());</span>
<span class="nc" id="L218">                } else {</span>
<span class="nc" id="L219">                    document.insertString(0, line, attributes);</span>
<span class="nc" id="L220">                    textComponent.setCaretPosition(0);</span>
                }
<span class="nc" id="L222">            } catch (BadLocationException ble) {</span>
<span class="nc" id="L223">            }</span>

<span class="nc bnc" id="L225" title="All 2 branches missed.">            if (printStream != null) {</span>
<span class="nc" id="L226">                printStream.print(line);</span>
            }

<span class="nc" id="L229">            buffer.setLength(0);</span>
<span class="nc" id="L230">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>