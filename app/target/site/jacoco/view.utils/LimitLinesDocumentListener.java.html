<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LimitLinesDocumentListener.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Last Dawn</a> &gt; <a href="index.source.html" class="el_package">view.utils</a> &gt; <span class="el_source">LimitLinesDocumentListener.java</span></div><h1>LimitLinesDocumentListener.java</h1><pre class="source lang-java linenums">/* Last Dawn (c) by Toasty Studios is licensed under
 * Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. (CC BY-NC-ND 4.0)
 * For more information, visit the link: http://creativecommons.org/licenses/by-nc-nd/4.0/
 */
package view.utils;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.text.*;

/*
 *  A class to control the maximum number of lines to be stored in a Document
 *
 *  Excess lines can be removed from the start or end of the Document
 *  depending on your requirement.
 *
 *  a) if you append text to the Document, then you would want to remove lines
 *     from the start.
 *  b) if you insert text at the beginning of the Document, then you would
 *     want to remove lines from the end.
 */
public class LimitLinesDocumentListener implements DocumentListener
{
	private int maximumLines;
	private boolean isRemoveFromStart;

	/*
	 *  Specify the number of lines to be stored in the Document.
	 *  Extra lines will be removed from the start of the Document.
	 */
	public LimitLinesDocumentListener(int maximumLines)
	{
<span class="nc" id="L32">		this(maximumLines, true);</span>
<span class="nc" id="L33">	}</span>

	/*
	 *  Specify the number of lines to be stored in the Document.
	 *  Extra lines will be removed from the start or end of the Document,
	 *  depending on the boolean value specified.
	 */
	public LimitLinesDocumentListener(int maximumLines, boolean isRemoveFromStart)
<span class="nc" id="L41">	{</span>
<span class="nc" id="L42">		setLimitLines(maximumLines);</span>
<span class="nc" id="L43">		this.isRemoveFromStart = isRemoveFromStart;</span>
<span class="nc" id="L44">	}</span>

	/*
	 *  Return the maximum number of lines to be stored in the Document
	 */
	public int getLimitLines()
	{
<span class="nc" id="L51">		return maximumLines;</span>
	}

	/*
	 *  Set the maximum number of lines to be stored in the Document
	 */
	public void setLimitLines(int maximumLines)
	{
<span class="nc bnc" id="L59" title="All 2 branches missed.">		if (maximumLines &lt; 1)</span>
		{
<span class="nc" id="L61">			String message = &quot;Maximum lines must be greater than 0&quot;;</span>
<span class="nc" id="L62">			throw new IllegalArgumentException(message);</span>
		}

<span class="nc" id="L65">		this.maximumLines = maximumLines;</span>
<span class="nc" id="L66">	}</span>

	//  Handle insertion of new text into the Document

	public void insertUpdate(final DocumentEvent e)
	{
		//  Changes to the Document can not be done within the listener
		//  so we need to add the processing to the end of the EDT

<span class="nc" id="L75">		SwingUtilities.invokeLater( new Runnable()</span>
<span class="nc" id="L76">		{</span>
			public void run()
			{
<span class="nc" id="L79">				removeLines(e);</span>
<span class="nc" id="L80">			}</span>
		});
<span class="nc" id="L82">	}</span>

<span class="nc" id="L84">	public void removeUpdate(DocumentEvent e) {}</span>
<span class="nc" id="L85">	public void changedUpdate(DocumentEvent e) {}</span>

	/*
	 *  Remove lines from the Document when necessary
	 */
	private void removeLines(DocumentEvent e)
	{
		//  The root Element of the Document will tell us the total number
		//  of line in the Document.

<span class="nc" id="L95">		Document document = e.getDocument();</span>
<span class="nc" id="L96">		Element root = document.getDefaultRootElement();</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">		while (root.getElementCount() &gt; maximumLines)</span>
		{
<span class="nc bnc" id="L100" title="All 2 branches missed.">			if (isRemoveFromStart)</span>
			{
<span class="nc" id="L102">				removeFromStart(document, root);</span>
			}
			else
			{
<span class="nc" id="L106">				removeFromEnd(document, root);</span>
			}
		}
<span class="nc" id="L109">	}</span>

	/*
	 *  Remove lines from the start of the Document
	 */
	private void removeFromStart(Document document, Element root)
	{
<span class="nc" id="L116">		Element line = root.getElement(0);</span>
<span class="nc" id="L117">		int end = line.getEndOffset();</span>

		try
		{
<span class="nc" id="L121">			document.remove(0, end);</span>
		}
<span class="nc" id="L123">		catch(BadLocationException ble)</span>
		{
<span class="nc" id="L125">			System.out.println(ble);</span>
<span class="nc" id="L126">		}</span>
<span class="nc" id="L127">	}</span>

	/*
	 *  Remove lines from the end of the Document
	 */
	private void removeFromEnd(Document document, Element root)
	{
		//  We use start minus 1 to make sure we remove the newline
		//  character of the previous line

<span class="nc" id="L137">		Element line = root.getElement(root.getElementCount() - 1);</span>
<span class="nc" id="L138">		int start = line.getStartOffset();</span>
<span class="nc" id="L139">		int end = line.getEndOffset();</span>

		try
		{
<span class="nc" id="L143">			document.remove(start - 1, end - start);</span>
		}
<span class="nc" id="L145">		catch(BadLocationException ble)</span>
		{
<span class="nc" id="L147">			System.out.println(ble);</span>
<span class="nc" id="L148">		}</span>
<span class="nc" id="L149">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>